Index: resources/js/Pages/Sigaa/PIT/ShowPit.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><script setup lang=\"ts\">\nimport Pagination from '@/Components/Pagination.vue';\nimport TextInput from '@/Components/TextInput.vue';\nimport AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';\nimport { Head, router, Link } from '@inertiajs/vue3';\nimport { watch } from 'vue';\nimport { reactive } from 'vue';\nimport pickBy from \"lodash/pickBy\";\nimport throttle from \"lodash/throttle\";\nimport { ref } from 'vue';\nimport FullLayout from '@/Layouts/full/FullLayout.vue';\nimport BaseBreadcrumb from '@/Components/shared/BaseBreadcrumb.vue';\nimport UiParentCard from '@/Components/shared/UiParentCard.vue';\nimport IconColor from \"@/Components/Buttons/IconColor.vue\";\n\nconst props = defineProps({\n    encargo: Object,\n    somaTotalCh: Object\n});\nconsole.log(props.somaTotalCh)\nconsole.log(props.encargo)\nconst page = ref({ title: 'PIT' });\nconst breadcrumbs = ref([\n    {\n        text: 'Plano',\n        disabled: false,\n        href: '#'\n    },\n    {\n        text: 'PIT',\n        disabled: true,\n        href: '#'\n    }\n]);\n\n\n\nconst getColor = (status) => {\n    if (status === 'ENSINO') return '#13DEB9'\n    else if (status === 'EXTENSÃO') return '#FA896B'\n    else if (status === 'PESQUISA') return '#5D87FF'\n    else return '#FFAE1F'\n}\n\n</script>\n\n<template>\n    <Head title=\"Plano Academico\" />\n\n    <FullLayout>\n        <BaseBreadcrumb :title=\"page.title\" :breadcrumbs=\"breadcrumbs\"></BaseBreadcrumb>\n        <v-row>\n            <v-col cols=\"12\">\n                <UiParentCard title=\"Projetos\">\n                    <div class=\" mx-auto sm:px-6 lg:px-8\">\n                        <div class=\"bg-white overflow-hidden shadow-sm sm:rounded-lg\">\n                            <table class=\"min-w-full divide-y divide-gray-200 dark:divide-gray-700\">\n                                <thead>\n                                    <tr>\n                                    <th scope=\"col\" class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">ID</th>\n                                    <th scope=\"col\" class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">PIT inicio</th>\n                                    <th scope=\"col\" class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">PIT Fim</th>\n                                    </tr>\n                                </thead>\n                                <tbody class=\"divide-y divide-gray-200 dark:divide-gray-700\">\n                                    <tr v-for=\"pit in pits\">\n                                        <td class=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800 dark:text-gray-200\">{{pit.id}}</td>\n<!--                                        <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-800 dark:text-gray-200\">-->\n<!--                                            <v-chip :color=\"getColor(planoAcademico.descricao)\">-->\n<!--                                                {{ planoAcademico.descricao }}-->\n<!--                                            </v-chip>-->\n<!--                                        </td>-->\n\n                                        <td class=\"px-6 py-4 text-sm text-gray-800 dark:text-gray-200\">{{pit.pit_data_inicio}}</td>\n                                        <td class=\"px-6 py-4 text-sm text-gray-800 dark:text-gray-200\">{{pit.pit_data_fim}}</td>\n                                        <td class=\"px-6 py-4 text-sm text-gray-800 dark:text-gray-200\">{{pit.pit_data_fim}}</td>\n                                        <td class=\"px-6 py-4 text-sm text-gray-800 dark:text-gray-200\">{{pit.pit_data_fim}}</td>\n\n\n\n                                        <tr v-for=\"ausencia in pit.ausencia\">\n                                            <td class=\"px-6 py-4 text-sm text-gray-800 dark:text-gray-200\">{{ausencia.tipo_ausencia.denominacao}}</td>\n\n                                            <td class=\"px-6 py-4 text-sm text-gray-800 dark:text-gray-200\">ch_semanal {{ausencia.ch_semanal}}</td>\n                                        </tr>\n\n\n                                    </tr>\n                                </tbody>\n                             </table>\n<!--                            <Pagination class=\"mt-6\" :links=\"projetos.links\" />-->\n                        </div>\n                    </div>\n                </UiParentCard>\n            </v-col>\n        </v-row>\n    </FullLayout>\n</template>\n
===================================================================
diff --git a/resources/js/Pages/Sigaa/PIT/ShowPit.vue b/resources/js/Pages/Sigaa/PIT/ShowPit.vue
--- a/resources/js/Pages/Sigaa/PIT/ShowPit.vue	
+++ b/resources/js/Pages/Sigaa/PIT/ShowPit.vue	
@@ -15,10 +15,12 @@
 
 const props = defineProps({
     encargo: Object,
-    somaTotalCh: Object
+    somaTotalCh: Object,
+    turma: Object,
+    subSomaEnsino: Object
 });
-console.log(props.somaTotalCh)
-console.log(props.encargo)
+console.log(props.turma)
+console.log(props.subSomaEnsino)
 const page = ref({ title: 'PIT' });
 const breadcrumbs = ref([
     {
Index: app/Http/Controllers/PitController.php
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?php\nnamespace App\\Http\\Controllers;\n\nuse App\\Http\\Controllers\\Sigaa\\OrientacaoGraduacaoController;\nuse App\\Models\\Administrativo\\Ausencia;\nuse App\\Models\\Administrativo\\Cargo;\nuse App\\Models\\Administrativo\\TipoAusencia;\nuse App\\Models\\Comum\\Servidor;\nuse App\\Models\\Sigaa\\OrientacaoAtividade;\nuse App\\Models\\Sigaa\\Projeto;\nuse App\\Models\\Sigaa\\saad\\EncargoAdministrativo;\nuse App\\Models\\Sigaa\\saad\\TiposEncargosAdminstrativos;\nuse App\\Models\\Sigaa\\Turma;\nuse Couchbase\\RoleAndDescription;\nuse Flowframe\\Trend\\Trend;\nuse Illuminate\\Database\\Eloquent\\Builder;\nuse Illuminate\\Database\\Eloquent\\ModelNotFoundException;\nuse Illuminate\\Http\\Request;\nuse App\\Models\\Pit;\nuse Illuminate\\Support\\Facades\\DB;\nuse Inertia\\Inertia;\nuse Inertia\\Response;\nuse Carbon\\Carbon;\n\nclass PitController extends Controller\n{\n\n    public function index(): Response\n    {\n        $pits = Pit::with(\n            'servidor',\n            'servidor.pessoa',\n            'planoAcademico'\n        );\n\n//        $pits = $pits->whereHas('servidor.pessoa', function($query){\n//                $query->where('nome', 'ilike', '%'.request('search').'%');\n//            });\n\n        $pits = $pits->orderby('id', 'DESC')\n            ->paginate(100)\n            ->withQueryString()\n            ->through(function ($pits) {\n                return [\n                    'id' => $pits->id,\n                    'docente' => $pits?->servidor?->pessoa?->nome,\n                    'email' => $pits?->servidor?->pessoa?->email,\n                    'siape' => $pits->servidor?->siape,\n                    'periodo' => $pits->planoAcademico->data_inicio->format('d/m/Y').\" - \".$pits->planoAcademico->data_fim->format('d/m/Y')\n                ];\n            });\n\n\n        return Inertia::render('Sigaa/PIT/Index', [\n            'pits' => $pits,\n            'filters' => request()->all(['search'])\n        ]);\n    }\n\n    public function showPit($id)\n    {\n        $somaTotalCh = array();\n        $subSomaEnsino = 0 ;\n\n        $pits = Pit::with([\n            'servidor',\n            'servidor.pessoa',\n            'servidor.cargo',\n            'planoAcademico',\n        ])->where('id','=',$id)->get();\n\n\n        $ausencia = $this->getChAusencia($id) ?? '';\n        $projetos = $this->getProjetos($id) ?? '';\n        $encargo = $this->getEncargoAdmin(565) ?? '';\n        $orientacao = $this->getOrientacao(578) ?? '';\n        $turmas = $this->getTurmaEnsino(578);\n\n        //15% para o savio\n        foreach ($projetos as $key => &$projeto) {\n            $tipoProjeto = $projeto['tipo_projeto'];\n\n            if (!isset($somaTotalCh[$tipoProjeto])) {\n                $somaTotalCh[$tipoProjeto] = 0;\n            }\n\n            if ($tipoProjeto == 'EXTENSÃO') {\n                $projeto[\"ch_semanal_extensao\"] = self::calcularChExtensao($projeto['ch_semanal'], $projeto['data_inicio'], $projeto['data_fim']);\n                $somaTotalCh[$tipoProjeto] += $projeto[\"ch_semanal_extensao\"];\n            }else if ($tipoProjeto == 'PESQUISA'){\n                $somaTotalCh[$tipoProjeto] += $projeto['ch_semanal'];\n            }\n\n            if ($somaTotalCh[$tipoProjeto] > 20)\n                $somaTotalCh[$tipoProjeto] = 20;\n            $projetos[$key] = $projeto;\n        }\n\n\n\n//     formula para calcular a cargo horaria de preparação\n//     ch_preparação = (chTeorica / NumSemana) + (chPratica / NumSemana)\n        foreach ($turmas as $key=> &$t){\n\n            if($t['tipo_ensino'] == 'G'){\n                $subSomaEnsino += $t['ch_teorico'] + $t['ch_pratico'];\n                $t['ch_preparacao'] = round(($t['ch_teorico']/ 15) + ($t['ch_pratico'] /15), 2);\n            }\n            $turmas[$key] = $t;\n        }\n\n        return Inertia::render('Sigaa/PIT/ShowPit',[\n            'somaTotalCh'=>$somaTotalCh,\n            'subSomaEnsino' => $subSomaEnsino,\n            'orientacao' => $orientacao,\n            'projeto' => $projetos,\n            'turma' => $turmas,\n            'ausencia' => $ausencia,\n            'encargo' => $encargo\n\n        ]);\n    }\n\n    public function getTurmaEnsino($idServidor){\n//        numero de semanas de um periodo letivo\n        $num_semana = 15;\n        $turma = Turma::with('docenteTurma','componenteCurricular', 'componenteCurricular.componenteCurricularDetalhe')\n            ->whereHas('docenteTurma', function ($query) use ($idServidor){\n                $query->where('id_docente', $idServidor);\n            })\n            ->get();\n\n        return $turma->map(function ($query) use ($num_semana){\n            return [\n                'disciplina' => $query?->componenteCurricular?->componenteCurricularDetalhe?->nome,\n                'codigo' => $query?->componenteCurricular?->codigo,\n\n                'ch_total' => $query?->componenteCurricular?->componenteCurricularDetalhe?->ch_total,\n                'ch_teorico' => round($query?->componenteCurricular?->componenteCurricularDetalhe?->ch_teorico / $num_semana, 2),\n                'ch_pratico' => round($query?->componenteCurricular?->componenteCurricularDetalhe?->ch_pratico / $num_semana, 2),\n                'unidade'=> $query?->componenteCurricular?->unidade?->sigla,\n                'curso'=> $query?->componenteCurricular?->curso?->nome,\n                'tipo_ensino' => $query?->componenteCurricular?->nivel\n            ];\n        });\n    }\n\n    public function getChAusencia($idServidor){\n        return Ausencia::with('tipoAusencia')->where('id_servidor', '=', $idServidor)->get();\n    }\n\n    public function getProjetos($idServidor){\n        $projeto = Projeto::with('coordenador', 'tipoProjeto', 'unidade')\n            ->whereHas('coordenador', function ($query) use ($idServidor){\n                $query->where('id_pessoa', $idServidor);\n            })->get();\n\n        return $projeto->map(function ($query){\n            return [\n                'nome' => $query?->coordenador?->pessoa?->nome,\n                'nome_portaria' => $query->nome_portaria,\n                'titulo' => $query?->titulo,\n                'data_inicio' => $query?->data_inicio?->format('d/m/Y'),\n                'data_fim' => $query?->data_fim?->format('d/m/Y'),\n                'unidade' => $query?->unidade?->sigla,\n                'tipo_projeto' => $query?->tipoProjeto?->descricao,\n                'ch_semanal' => $query?->coordenador->ch_semanal,\n            ];\n        });\n    }\n\n//    Captura as orientação de TCC, Estagio e tese\n    public function getOrientacao($idServidor){\n        $OrientacaoGraduacao = OrientacaoAtividade::with(\n            'servidor',\n            'registroAtividade',\n            'registroAtividade.matriculaComponente',\n            'registroAtividade.matriculaComponente.discente',\n            'registroAtividade.matriculaComponente.discente.pessoa',\n            'registroAtividade.matriculaComponente.componenteCurricularDetalhe',\n            'registroAtividade.matriculaComponente.componenteCurricularDetalhe.componenteCurricular'\n        )->where('id_servidor', '=',$idServidor)->get();\n\n    // ch/15 = 15 semanas\n        return $OrientacaoGraduacao->map(function ($query){\n           return [\n               'atividade' => $query?->registroAtividade?->matriculaComponente?->componenteCurricularDetalhe?->nome,\n               'discente' => $query?->registroAtividade?->matriculaComponente?->discente?->pessoa?->nome,\n               'mae' =>  $query?->registroAtividade?->matriculaComponente?->discente?->pessoa?->nome_mae,\n\n               'codigo' => $query?->registroAtividade?->matriculaComponente?->componenteCurricularDetalhe?->codigo,\n               'curso' => $query?->registroAtividade?->matriculaComponente?->componenteCurricularDetalhe?->componenteCurricular?->curso?->nome,\n\n               'unidade' => $query?->registroAtividade?->matriculaComponente?->componenteCurricularDetalhe?->componenteCurricular?->unidade?->nome,\n               'ch_semanal' => $query->carga_horaria,\n\n           ];\n        });\n\n    }\n\n    public function getEncargoAdmin($idSevidor){\n        $encargo = EncargoAdministrativo::with('servidor','unidade' )\n            ->where('id_servidor' , '=', $idSevidor)->get();\n\n\n        return $encargo\n            ->map(function ($query){\n            return[\n                'funcao' => $query?->funcao,\n                'portaria' => $query?->portaria,\n                'inicio' => $query?->inicio,\n                'fim' => $query?->fim,\n                'unidade' => $query?->unidade?->sigla,\n                'ch_semanal' => $query->ch_semanal\n            ];\n        });\n    }\n\n    public static function qtdSemanas($datainicial, $datafinal){\n        $dias = self::diasUteis($datainicial, $datafinal);\n        return $dias/7;\n    }\n\n    public static function diasUteis($datainicial,$datafinal=null){\n\n        if (!isset($datainicial)) return false;\n\n        $segundos_datainicial = strtotime(str_replace(\"/\",\"-\",$datainicial));\n\n        if (!isset($datafinal)) $segundos_datafinal=time();\n\n        else $segundos_datafinal = strtotime(str_replace(\"/\",\"-\",$datafinal));\n\n        $dias = abs(floor(floor(($segundos_datafinal-$segundos_datainicial)/3600)/24 ) );\n        $uteis=0;\n\n        for($i=1;$i<=$dias;$i++){\n            $diai = $segundos_datainicial+($i*3600*24);\n            //$w = date('w',$diai);\n            //if ($w>0 && $w<6){\n            $uteis++;\n            //}\n        }\n        return $uteis+1;\n    }\n\n    public static function calcularChExtensao($ch, $dataInicio, $dataFim){\n\n        $qtdSemanas = floor(self::qtdSemanas($dataInicio, $dataFim));\n        if($qtdSemanas > 0){\n            return floor($ch/$qtdSemanas);\n        }\n        return $ch;\n    }\n}\n\n\n\n\n
===================================================================
diff --git a/app/Http/Controllers/PitController.php b/app/Http/Controllers/PitController.php
--- a/app/Http/Controllers/PitController.php	
+++ b/app/Http/Controllers/PitController.php	
@@ -112,9 +112,9 @@
         return Inertia::render('Sigaa/PIT/ShowPit',[
             'somaTotalCh'=>$somaTotalCh,
             'subSomaEnsino' => $subSomaEnsino,
+            'turma' => $turmas,
             'orientacao' => $orientacao,
             'projeto' => $projetos,
-            'turma' => $turmas,
             'ausencia' => $ausencia,
             'encargo' => $encargo
 
